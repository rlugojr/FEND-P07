<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="My Nav Points">
        <meta name="author" content="Ray Lugo, Jr.">

        <title>My Nav Points</title>
        <link rel="stylesheet" href="css/style.css" media="screen" />
        <!--<link rel="stylesheet" href="css/print.css" media="print"/>
        <link async rel="stylesheet" href="css/fonts.css" media="data"/>-->
    </head>

    <body>
        <div class="container">
            <div class="options-box">
                <h1>Find a Home in NYC</h1>
                <div>
                    <input id="show-listings" type="button" value="Show Listings">
                    <input id="hide-listings" type="button" value="Hide Listings">
                    <hr>
                    <span class="text">Draw a shape to search within it for homes!</span>
                    <input id="toggle-drawing" type="button" value="Drawing Tools">
                </div>
                <hr>
                <div>
                    <input id="zoom-to-area-text" type="text" placeholder="Enter your favorite area!">
                    <input id="zoom-to-area" type="button" value="zoom">
                </div>
                <hr>
                <div>
                    <span class="text">Within </span>
                    <select id="max-duration">
                        <option value="10">10 min</option>
                        <option value="15">15 min</option>
                        <option value="30">30 min</option>
                        <option value="60">60 min</option>
                    </select>
                    <select id="mode">
                        <option value="DRIVING">Drive</option>
                        <option value="WALKING">Walk</option>
                        <option value="BICYCLING">Bike</option>
                        <option value="TRANSIT">Transit Ride</option>
                    </select>
                    <span class="text">of</span>
                    <input id="search-within-time-text" type="text" placeholder="5 Times Square, NY">
                    <input id="search-within-time" type="button" value="Go">
                </div>
            </div>
            <div id="map"></div>
        </div>
        <script>
            var map;

            var markers = [];

            var polygon = null;

            function initMap() {

                var styles = [{
                    featureType: "road.highway",
                    elementType: "labels",
                    stylers: [{
                        visibility: "on"
                    }]
                }, {
                    featureType: "road.arterial",
                    elementType: "labels.text",
                    stylers: [{
                        visibility: "on"
                    }]
                }, {
                    featureType: "road.local",
                    elementType: "labels.text",
                    stylers: [{
                        visibility: "on"
                    }]
                }, {
                    featureType: "water",
                    elementType: "geometry.fill",
                    stylers: [{
                        color: "#0099dd"
                    }]
                }, {
                    featureType: "poi.park",
                    elementType: "geometry.fill",
                    stylers: [{
                        color: "#aadd55"
                    }]
                }, {
                    featureType: 'administrative',
                    elementType: 'labels.text.stroke',
                    stylers: [{
                        color: '#ffffff'
                    }, {
                        weight: 6
                    }]
                }, {
                    featureType: 'administrative',
                    elementType: 'labels.text.fill',
                    stylers: [{
                        color: '#e85113'
                    }]
                }, {
                    featureType: 'road.highway',
                    elementType: 'geometry.stroke',
                    stylers: [{
                        color: '#efe9e4'
                    }, {
                        lightness: -40
                    }]
                }, {
                    featureType: 'transit.station',
                    stylers: [{
                        weight: 9
                    }, {
                        hue: '#e85113'
                    }]
                }, {
                    featureType: 'road.highway',
                    elementType: 'labels.icon',
                    stylers: [{
                        visibility: 'off'
                    }]
                }, {
                    featureType: 'water',
                    elementType: 'labels.text.stroke',
                    stylers: [{
                        lightness: 100
                    }]
                }, {
                    featureType: 'water',
                    elementType: 'labels.text.fill',
                    stylers: [{
                        lightness: -100
                    }]
                }, {
                    featureType: 'poi',
                    elementType: 'geometry',
                    stylers: [{
                        visibility: 'on'
                    }, {
                        color: '#f0e4d3'
                    }]
                }, {
                    featureType: 'road.highway',
                    elementType: 'geometry.fill',
                    stylers: [{
                        color: '#efe9e4'
                    }, {
                        lightness: -25
                    }]
                }];

                map = new google.maps.Map(document.getElementById('map'), {
                    center: {
                        lat: 40.755781,
                        lng: -73.987548
                    },
                    zoom: 12,
                    styles: styles,
                    mapTypeControl: false
                });
                var locations = [{
                    title: 'Times Square',
                    location: {
                        lat: 40.755781,
                        lng: -73.987548
                    }
                }, {
                    title: 'Port Authority Bus Terminal',
                    location: {
                        lat: 40.757429,
                        lng: -73.989934
                    }
                }, {
                    title: 'NY Penn Station',
                    location: {
                        lat: 40.750303,
                        lng: -73.990906
                    }
                }, {
                    title: '42nd Street Tourist Area',
                    location: {
                        lat: 40.756668,
                        lng: -73.98846
                    }
                }, {
                    title: 'Theater District',
                    location: {
                        lat: 40.748441,
                        lng: -73.985664
                    }
                }, {
                    title: 'Empire State Building',
                    location: {
                        lat: 40.748441,
                        lng: -73.985664
                    }
                }, {
                    title: 'United Nations HQ',
                    location: {
                        lat: 40.749423,
                        lng: -73.968051
                    }
                }, {
                    title: 'American Museum of Natural History',
                    location: {
                        lat: 40.781324,
                        lng: -73.973988
                    }
                }, {
                    title: 'The Museum of Modern Art',
                    location: {
                        lat: 40.761417,
                        lng: -73.97712
                    }
                }, {
                    title: 'Grand Central Station',
                    location: {
                        lat: 40.753984,
                        lng: -73.977464
                    }
                }, {
                    title: 'The Interpid',
                    location: {
                        lat: 40.76473,
                        lng: -74.000001
                    }
                }, {
                    title: 'Statue of Liberty',
                    location: {
                        lat: 40.69005,
                        lng: -74.045068
                    }
                }, {
                    title: 'Ellis Island',
                    location: {
                        lat: 40.699472,
                        lng: -74.03956
                    }
                }, {
                    title: 'Central Park South Entrance',
                    location: {
                        lat: 40.771133,
                        lng: -73.974187
                    }
                }, {
                    title: 'Little Italy',
                    location: {
                        lat: 40.719141,
                        lng: -73.997327
                    }
                }, {
                    title: 'Chinatown',
                    location: {
                        lat: 40.715751,
                        lng: -73.997031
                    }
                }];

                var largeInfoWindow = new google.maps.InfoWindow();

                var drawingManager = new google.maps.drawing.DrawingManager({
                    drawingMode: google.maps.drawing.OverlayType.POLYGON,
                    drawingControl: true,
                    drawingControlOptions: {
                        position: google.maps.ControlPosition.TOP_LEFT,
                        drawingModes: [google.maps.drawing.OverlayType.POLYGON]
                    }
                });

                var defaultIcon = makeMarkerIcon('0091ff');

                var highlightedIcon = makeMarkerIcon('ffff24');

                var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

                for (var i = 0; i < locations.length; i++) {
                    var position = locations[i].location;
                    var title = locations[i].title;
                    var marker = new google.maps.Marker({
                        position: position,
                        title: title,
                        icon: defaultIcon,
                        label: labels[i],
                        animation: google.maps.Animation.DROP,
                        id: i
                    });

                    markers.push(marker);

                    marker.addListener('click', function() {
                        populateInfoWindow(this, largeInfoWindow);
                    });

                    marker.addListener('mouseover', function() {
                        this.setIcon(highlightedIcon);
                    });

                    marker.addListener('mouseout', function() {
                        this.setIcon(defaultIcon);
                    });


                }
                document.getElementById('show-listings').addEventListener('click', showListings);
                document.getElementById('hide-listings').addEventListener('click', hideListings);

                document.getElementById('toggle-drawing').addEventListener('click', function() {
                    toggleDrawing(drawingManager);
                });

                document.getElementById('zoom-to-area').addEventListener('click', function() {
                    zoomToArea();
                });

                drawingManager.addListener('overlaycomplete', function(event) {
                    // First, check if there is an existing polygon.
                    // If there is, get rid of it and remove the markers
                    if (polygon) {
                        polygon.setMap(null);
                        hideListings(markers);
                    }
                    // Switching the drawing mode to the HAND (i.e., no longer drawing).
                    drawingManager.setDrawingMode(null);
                    // Creating a new editable polygon from the overlay.
                    polygon = event.overlay;
                    polygon.setEditable(true);
                    // Searching within the polygon.
                    searchWithinPolygon();
                    // Make sure the search is re-done if the poly is changed.
                    polygon.getPath().addListener('set_at', searchWithinPolygon);
                    polygon.getPath().addListener('insert_at', searchWithinPolygon);
                });
            }

            function populateInfoWindow(marker, infowindow) {
                if (infowindow.marker != marker) {

                    infowindow.setContent('');
                    infowindow.marker = marker;

                    //infowindow.open(map, marker);

                    infowindow.addListener('closeclick', function() {
                        infowindow.marker = null;
                    });
                    var streetViewService = new google.maps.StreetViewService();
                    var radius = 50;

                    function getStreetView(data, status) {
                        if (status == google.maps.StreetViewStatus.OK) {
                            var nearStreetViewLocation = data.location.latLng;
                            var heading = google.maps.geometry.spherical.computeHeading(nearStreetViewLocation, marker.position);
                            var info = '<div>' + marker.title + '</div><div id="pano"></div>';
                            infowindow.setContent(info);
                            var panoramaOptions = {
                                position: nearStreetViewLocation,
                                pov: {
                                    heading: heading,
                                    pitch: 30
                                }
                            };
                            var panorama = new google.maps.StreetViewPanorama(document.getElementById('pano'), panoramaOptions);
                        } else {
                            infowindow.setContent('<div>' + marker.title + '</div><div>No Street View Found</div>');
                        }
                    }
                    streetViewService.getPanoramaByLocation(marker.position, radius, getStreetView);

                    infowindow.open(map, marker);
                }
            }


            function showListings() {
                var bounds = new google.maps.LatLngBounds();

                for (var i = 0; i < markers.length; i++) {
                    markers[i].setMap(map);
                    bounds.extend(markers[i].position);
                }
                map.fitBounds(bounds);
            }

            function hideListings() {
                for (var i = 0; i < markers.length; i++) {
                    markers[i].setMap(null);
                }
            }

            function makeMarkerIcon(markerColor) {
                var markerImage = new google.maps.MarkerImage(
                    'http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|' + markerColor +
                    '|40|_|%E2%80%A2',
                    new google.maps.Size(21, 34),
                    new google.maps.Point(0, 0),
                    new google.maps.Point(10, 34),
                    new google.maps.Size(21, 34));
                return markerImage;
            }

            function toggleDrawing(drawingManager) {
                if (drawingManager.map) {
                    drawingManager.setMap(null);
                    if (polygon !== null) {
                        polygon.setMap(null);
                    }
                } else {
                    drawingManager.setMap(map);
                }
            }

            function searchWithinPolygon() {
                for (var i = 0; i < markers.length; i++) {
                    if (google.maps.geometry.poly.containsLocation(markers[i].position, polygon)) {
                        markers[i].setMap(map);
                    } else {
                        markers[i].setMap(null);
                    }
                }
            }

            function zoomToArea() {
                var geocoder = new google.maps.Geocoder();
                var address = document.getElementById('zoom-to-area-text').value;

                if (address === '') {
                    window.alert('you must enter an area or address.');
                } else {
                    geocoder.geocode({
                        address: address,
                        componentRestrictions: {
                            locality: 'New York'
                        }
                    }, function(results, status) {
                        if (status == google.maps.GeocoderStatus.OK) {
                            map.setCenter(results[0].geometry.location);
                            map.setZoom(15);
                        } else {
                            window.alert('We could not find that location - try entering a more specific place.');
                        }
                    });
                }
            }
        </script>


        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB4Sx-EmG0FVrUBwkOuk9Btwv2cW3jjuZg&libraries=drawing,geometry&v=3&callback=initMap">
        </script>
        <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>-->
        <!--<<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.0/knockout-min.js"></script>
        <script src="js/app.js"></script>-->
    </body>
    <footer>
        <p>&copy; https://github.com/rlugojr 2016</p>
    </footer>

</html>
